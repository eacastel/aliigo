{
  "version": 3,
  "sources": ["../../../src/widget/v1/aliigo-widget.ts"],
  "sourcesContent": ["// src/widget/v1/aliigo-widget.ts\n\ntype Role = \"user\" | \"assistant\";\ntype Action =\n  | { type: \"link\"; label: string; url: string }\n  | { type: \"handoff\"; label: string; channels?: (\"email\"|\"telegram\"|\"whatsapp\")[] };\n\ntype Msg = { role: Role; content: string; actions?: Action[] };\n\ntype Theme = {\n  headerBg?: string;   // \"#111827 #ffffff\"\n  bubbleUser?: string; // \"#2563eb #ffffff\"\n  bubbleBot?: string;  // \"#f3f4f6 #111827\"\n  sendBg?: string;     // \"#2563eb #ffffff\"\n  panelBg?: string;        // \"#09090b\"\n  panelOpacity?: number;   // 0..1\n};\n\ntype SessionPayload = {\n  token: string;\n  locale: \"en\" | \"es\";\n  brand: string;\n  slug: string;\n  theme: Theme | null;\n};\n\ntype WidgetState = {\n  open: boolean;\n  busy: boolean;\n  conversationId: string | null;\n  msgs: Msg[];\n  session: SessionPayload | null;\n  locale: \"en\" | \"es\";\n  visitorSessionId: string | null;\n};\n\ntype ServerAction =\n  | { type: \"cta\"; label: string; url: string }\n  | { type: \"collect_lead\"; fields: (\"name\" | \"email\" | \"phone\")[]; reason?: string };\n\nfunction mapServerActionsToWidget(actions: unknown): Action[] | undefined {\n  if (!Array.isArray(actions)) return undefined;\n\n  const out: Action[] = [];\n\n  for (const a of actions) {\n    if (!a || typeof a !== \"object\") continue;\n    const obj = a as Record<string, unknown>;\n    const t = obj.type;\n\n    if (t === \"cta\") {\n      const label = typeof obj.label === \"string\" ? obj.label : \"\";\n      const url = typeof obj.url === \"string\" ? obj.url : \"\";\n      if (label && url) out.push({ type: \"link\", label, url });\n      continue;\n    }\n\n    if (t === \"collect_lead\") {\n      // Simple for now: one handoff button (you can build a lead form later)\n      out.push({ type: \"handoff\", label: \"Talk to a person\" });\n      continue;\n    }\n  }\n\n  return out.length ? out : undefined;\n}\n\n\nconst UI = {\n  en: {\n    pill: (brand: string) => (brand ? `Ask ${brand}` : \"Chat\"),\n    title: (brand: string) => (brand ? `${brand} Assistant` : \"Assistant\"),\n    welcome: \"Ask a question and we\u2019ll help right away.\",\n    placeholder: \"Type your question\u2026\",\n    send: \"Send\",\n  },\n  es: {\n    pill: (brand: string) => (brand ? `Pregunta a ${brand}` : \"Chat\"),\n    title: (brand: string) => (brand ? `Asistente de ${brand}` : \"Asistente\"),\n    welcome: \"Haz tu consulta y te ayudamos al momento.\",\n    placeholder: \"Escribe tu consulta\u2026\",\n    send: \"Enviar\",\n  },\n} as const;\n\nfunction isEs(locale: string) {\n  return (locale || \"\").toLowerCase().startsWith(\"es\");\n}\n\nfunction splitPair(v?: string, defaults?: { bg: string; text: string }) {\n  const s = (v || \"\").trim();\n  const m = s.match(/#([0-9a-fA-F]{3}){1,2}/g) || [];\n  const bg = m[0] || defaults?.bg || \"#111827\";\n  const text = m[1] || defaults?.text || \"#ffffff\";\n  return { bg, text };\n}\n\nfunction clamp01(n: number) {\n  return Math.max(0, Math.min(1, n));\n}\n\nfunction hexToRgb(hex: string): { r: number; g: number; b: number } | null {\n  const h = (hex || \"\").trim().replace(\"#\", \"\");\n  if (h.length === 3) {\n    const r = parseInt(h[0] + h[0], 16);\n    const g = parseInt(h[1] + h[1], 16);\n    const b = parseInt(h[2] + h[2], 16);\n    return { r, g, b };\n  }\n  if (h.length === 6) {\n    const r = parseInt(h.slice(0, 2), 16);\n    const g = parseInt(h.slice(2, 4), 16);\n    const b = parseInt(h.slice(4, 6), 16);\n    return { r, g, b };\n  }\n  return null;\n}\n\nfunction rgbaFromHex(hex: string, a: number) {\n  const rgb = hexToRgb(hex);\n  if (!rgb) return null;\n  return `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, ${clamp01(a)})`;\n}\n\n\nclass AliigoWidget extends HTMLElement {\n  private root!: ShadowRoot;\n\n  private STORAGE_TTL_MS = 30 * 60 * 1000;\n  private STORAGE_PREFIX = \"aliigo_widget_v1\";\n\n  private pendingScroll: \"bottom\" | \"lastAssistantStart\" | null = null;\n\n  // TTL enforcement even without page refresh\n  private expiryTimer: number | null = null;\n  private lastActiveAtMs: number | null = null;\n\n  private lastRenderOpen = false;\n  private pendingFocus = false;\n\n  private sessionHydrated = false;\n  private cachedTheme: Theme | null = null;\n  private cachedBrand = \"\";\n\n  private onFocus = () => this.checkExpiryNow();\n  private onVis = () => {\n    if (!document.hidden) this.checkExpiryNow();\n  };\n\n  private state: WidgetState = {\n    open: false,\n    busy: false,\n    conversationId: null,\n    msgs: [],\n    session: null,\n    locale: \"en\",\n    visitorSessionId: null,\n  };\n\n  static get observedAttributes() {\n    return [\n      \"variant\", \"embed-key\", \"api-base\", \"locale\", \"session-token\",\n      \"floating-mode\", \"theme\", \"brand\",\n      \"start-open\",\n    ];\n  }\n\n  private ensureRoot() {\n    if (!this.shadowRoot) {\n      this.root = this.attachShadow({ mode: \"open\" });\n    } else {\n      this.root = this.shadowRoot;\n    }\n  }\n\n  connectedCallback() {\n    this.ensureRoot();\n    this.state.visitorSessionId = this.getOrCreateVisitorSessionId();\n\n    // restore transcript + conversationId (if within TTL)\n    this.loadPersisted();\n\n    // If we have recent persisted messages, auto-open on refresh (floating only)\n    if (this.getVariant() === \"floating\" && this.state.msgs.length > 0) {\n      this.state.open = true;\n      this.pendingScroll = \"bottom\";\n      this.pendingFocus = true;\n    }\n\n    // If client embed (fixed mode), move to <body> so it's truly viewport-fixed.\n    if (this.getVariant() === \"floating\" && this.getFloatingMode() === \"fixed\") {\n      const host = document.body;\n      if (this.parentElement !== host) host.appendChild(this);\n    }\n\n    if (this.getVariant() === \"floating\" && this.getStartOpen()) {\n      this.state.open = true;\n      this.pendingScroll = \"bottom\";\n      this.pendingFocus = true;\n    }\n\n    // Enforce TTL even when the tab stays open\n    window.addEventListener(\"focus\", this.onFocus);\n    document.addEventListener(\"visibilitychange\", this.onVis);\n    this.scheduleExpiryTimer();\n\n    this.sessionHydrated = false;\n    this.render();\n\n    void this.ensureSession().finally(() => {\n      this.sessionHydrated = true;\n      // If ensureSession already rendered an error (no session), don't overwrite it.\n      if (this.state.session || !this.getEmbedKey()) this.render();\n    });\n  }\n\n  disconnectedCallback() {\n    window.removeEventListener(\"focus\", this.onFocus);\n    document.removeEventListener(\"visibilitychange\", this.onVis);\n    this.clearExpiryTimer();\n  }\n\n  attributeChangedCallback(name: string, oldValue: string | null, newValue: string | null) {\n    if (oldValue === newValue) return;\n\n    this.ensureRoot();\n    this.render();\n\n    if (name === \"embed-key\" || name === \"api-base\" || name === \"session-token\") {\n      this.state.session = null;\n\n      // If the identity can change, reset cached skin + hydration\n      if (name === \"embed-key\" || name === \"session-token\") {\n        this.cachedTheme = null;\n        this.cachedBrand = \"\";\n        this.sessionHydrated = false;\n      }\n\n      void this.ensureSession().finally(() => {\n        this.sessionHydrated = true;\n        // Same rule: don't overwrite renderError output.\n        if (this.state.session || !this.getEmbedKey()) this.render();\n      });\n    }\n  }\n\n\n  private clearExpiryTimer() {\n    if (this.expiryTimer != null) {\n      window.clearTimeout(this.expiryTimer);\n      this.expiryTimer = null;\n    }\n  }\n\n  private scheduleExpiryTimer() {\n    this.clearExpiryTimer();\n\n    // Only enforce TTL if we have a conversation transcript to expire\n    if (!this.lastActiveAtMs || this.state.msgs.length === 0) return;\n\n    const msLeft = this.lastActiveAtMs + this.STORAGE_TTL_MS - Date.now();\n    if (msLeft <= 0) {\n      this.expireConversation();\n      return;\n    }\n\n    // Add a tiny buffer so we don't race exact millisecond boundaries\n    this.expiryTimer = window.setTimeout(() => {\n      this.checkExpiryNow();\n    }, msLeft + 50);\n  }\n\n  private checkExpiryNow() {\n    if (!this.lastActiveAtMs || this.state.msgs.length === 0) return;\n\n    const idleMs = Date.now() - this.lastActiveAtMs;\n    if (idleMs >= this.STORAGE_TTL_MS) {\n      this.expireConversation();\n    } else {\n      this.scheduleExpiryTimer();\n    }\n  }\n\n  private expireConversation() {\n    // Clear persisted transcript and reset in-memory conversation\n    this.clearPersisted();\n    this.lastActiveAtMs = null;\n    this.clearExpiryTimer();\n\n    this.state.msgs = [];\n    this.state.conversationId = null;\n    this.state.busy = false;\n\n    // For floating widgets, close on expiry\n    if (this.getVariant() === \"floating\") {\n      this.state.open = false;\n    }\n\n    this.render();\n  }\n\n  private applyPendingScroll() {\n    const messages = this.root.querySelector(\".messages\") as HTMLDivElement | null;\n    if (!messages || !this.pendingScroll) return;\n\n    const mode = this.pendingScroll;\n    this.pendingScroll = null;\n\n    // Snap immediately so you never see \u201Ctop\u201D\n    if (mode === \"bottom\") {\n      messages.scrollTop = messages.scrollHeight;\n    }\n\n    requestAnimationFrame(() => {\n      const max = Math.max(0, messages.scrollHeight - messages.clientHeight);\n\n      if (mode === \"bottom\") {\n        messages.scrollTop = max;\n        return;\n      }\n\n      // lastAssistantStart => jump to last assistant message top (with a little offset)\n      for (let i = this.state.msgs.length - 1; i >= 0; i--) {\n        if (this.state.msgs[i]?.role === \"assistant\") {\n          const el = this.root.querySelector(`#msg-${i}`) as HTMLElement | null;\n          if (!el) return;\n\n          const desired = el.offsetTop - 12;\n          messages.scrollTop = Math.max(0, Math.min(desired, max));\n          return;\n        }\n      }\n    });\n  }\n\n\n  private applyPendingFocus() {\n    if (!this.pendingFocus) return;\n    this.pendingFocus = false;\n\n    requestAnimationFrame(() => {\n      const input = this.root.querySelector(\".input\") as HTMLInputElement | null;\n      input?.focus({ preventScroll: true });\n    });\n  }\n\n\n  private getOrCreateVisitorSessionId() {\n    const k = \"aliigo_visitor_session_v1\";\n    try {\n      const existing = localStorage.getItem(k);\n      if (existing && existing.length >= 24) return existing;\n\n      const rnd = crypto.getRandomValues(new Uint8Array(16));\n      const id = Array.from(rnd).map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n      localStorage.setItem(k, id);\n      return id;\n    } catch {\n      // last resort (no storage): per-page random\n      return `${Date.now()}_${Math.random().toString(16).slice(2)}`;\n    }\n  }\n\n  private storageKey() {\n    // embed-key is stable for real embeds; session-token covers dashboard preview\n    const embedKey = this.getEmbedKey();\n    const overrideToken = this.getSessionTokenOverride();\n    const host = (window.location.hostname || \"\").toLowerCase();\n    const key = embedKey || overrideToken || \"no-key\";\n    return `${this.STORAGE_PREFIX}:${key}:${host}`;\n  }\n\n  private loadPersisted() {\n    try {\n      const raw = localStorage.getItem(this.storageKey());\n      if (!raw) return;\n\n      const parsed = JSON.parse(raw) as {\n        savedAt?: number;\n        lastActiveAt?: number;\n        open?: boolean;\n        conversationId?: string | null;\n        msgs?: Msg[];\n        locale?: \"en\" | \"es\";\n        theme?: Theme | null;\n        brand?: string;\n      };\n\n      if (parsed.theme) this.cachedTheme = parsed.theme;\n      if (typeof parsed.brand === \"string\") this.cachedBrand = parsed.brand;\n\n      const lastActive =\n        typeof parsed.lastActiveAt === \"number\"\n          ? parsed.lastActiveAt\n          : typeof parsed.savedAt === \"number\"\n            ? parsed.savedAt\n            : 0;\n\n      if (!lastActive || Date.now() - lastActive > this.STORAGE_TTL_MS) {\n        this.clearPersisted();\n        return;\n      }\n\n      if (typeof parsed.open === \"boolean\") this.state.open = parsed.open;\n      if (Array.isArray(parsed.msgs)) this.state.msgs = parsed.msgs;\n      if (typeof parsed.conversationId === \"string\") this.state.conversationId = parsed.conversationId;\n      if (parsed.locale === \"en\" || parsed.locale === \"es\") this.state.locale = parsed.locale;\n\n      // Track last active for live TTL expiry\n      if (this.state.msgs.length > 0) {\n        this.lastActiveAtMs = lastActive || Date.now();\n      }\n    } catch {\n      // ignore\n    }\n  }\n\n  private savePersisted(touch: boolean = true) {\n    try {\n      const k = this.storageKey();\n      const now = Date.now();\n\n      // Preserve original savedAt if it exists\n      let savedAt = now;\n\n      // Preserve previous lastActiveAt if touch=false\n      let prevLastActiveAt: number | undefined = undefined;\n\n      try {\n        const prevRaw = localStorage.getItem(k);\n        if (prevRaw) {\n          const prev = JSON.parse(prevRaw) as { savedAt?: number; lastActiveAt?: number };\n          if (typeof prev.savedAt === \"number\") savedAt = prev.savedAt;\n          if (typeof prev.lastActiveAt === \"number\") prevLastActiveAt = prev.lastActiveAt;\n        }\n      } catch {\n        // ignore parse issues\n      }\n\n      const nextLastActiveAt = touch ? now : prevLastActiveAt;\n\n      const payload = {\n        savedAt,\n        lastActiveAt: nextLastActiveAt,\n        conversationId: this.state.conversationId,\n        msgs: this.state.msgs,\n        locale: this.state.locale,\n        open: this.state.open,\n        theme: this.cachedTheme,\n        brand: this.cachedBrand,\n      };\n\n      localStorage.setItem(k, JSON.stringify(payload));\n\n      // update live TTL tracking\n      if (this.state.msgs.length > 0) {\n        this.lastActiveAtMs = touch ? now : (nextLastActiveAt ?? this.lastActiveAtMs);\n      } else {\n        this.lastActiveAtMs = null;\n      }\n\n      this.scheduleExpiryTimer();\n    } catch {\n      // ignore storage failures\n    }\n  }\n\n  private clearPersisted() {\n    try {\n      localStorage.removeItem(this.storageKey());\n    } catch {}\n  }\n\n  private getBrandOverride(): string | null {\n    const b = (this.getAttribute(\"brand\") || \"\").trim();\n    return b || null;\n  }\n\n  private getVariant(): \"floating\" | \"inline\" | \"hero\" {\n    const v = (this.getAttribute(\"variant\") || \"floating\").toLowerCase();\n    if (v === \"inline\" || v === \"hero\") return v;\n    return \"floating\";\n  }\n\n  private getEmbedKey() {\n    return (this.getAttribute(\"embed-key\") || \"\").trim();\n  }\n\n  private getApiBase() {\n    return (this.getAttribute(\"api-base\") || \"https://aliigo.com\").trim().replace(/\\/$/, \"\");\n  }\n\n  private getLocaleOverride(): \"en\" | \"es\" | null {\n    const v = (this.getAttribute(\"locale\") || \"\").trim().toLowerCase();\n    if (!v) return null;\n    return v.startsWith(\"es\") ? \"es\" : \"en\";\n  }\n\n  private getSessionTokenOverride(): string | null {\n    const t = (this.getAttribute(\"session-token\") || \"\").trim();\n    return t || null;\n  }\n\n  private getThemeOverride(): Theme | null {\n    const raw = (this.getAttribute(\"theme\") || \"\").trim();\n    if (!raw) return null;\n\n    try {\n      const o = JSON.parse(raw) as Partial<Theme>;\n      const out: Theme = {};\n\n      if (typeof o.headerBg === \"string\") out.headerBg = o.headerBg;\n      if (typeof o.bubbleUser === \"string\") out.bubbleUser = o.bubbleUser;\n      if (typeof o.bubbleBot === \"string\") out.bubbleBot = o.bubbleBot;\n      if (typeof o.sendBg === \"string\") out.sendBg = o.sendBg;\n      if (typeof o.panelBg === \"string\") out.panelBg = o.panelBg;\n      if (typeof o.panelOpacity === \"number\") out.panelOpacity = o.panelOpacity;\n\n\n      return out;\n    } catch {\n      return null;\n    }\n  }\n\n  private getStartOpen(): boolean {\n    return (this.getAttribute(\"start-open\") || \"\").toLowerCase() === \"true\";\n  }\n\n  private getFloatingMode(): \"fixed\" | \"absolute\" {\n    const v = (this.getAttribute(\"floating-mode\") || \"\").toLowerCase();\n    return v === \"absolute\" ? \"absolute\" : \"fixed\";\n  }\n\n  private async ensureSession(): Promise<SessionPayload | null> {\n    const overrideToken = this.getSessionTokenOverride();\n    const embedKey = this.getEmbedKey();\n    if (!embedKey && !overrideToken) return null;\n\n    // If we already have a session and it's still compatible with overrides, don\u2019t thrash\n    if (this.state.session && !overrideToken) return this.state.session;\n\n    try {\n      const apiBase = this.getApiBase();\n\n      if (overrideToken) {\n        const localeOverride = this.getLocaleOverride();\n        const themeOverride = this.getThemeOverride();\n        const brandOverride = this.getBrandOverride();\n\n        this.state.session = {\n          token: overrideToken,\n          locale: localeOverride || this.state.locale,\n          brand: (brandOverride || \"\").trim(),\n          slug: \"\",\n          theme: themeOverride,\n        };\n\n        this.cachedTheme = this.state.session.theme || null;\n        this.cachedBrand = this.state.session.brand || \"\";\n        this.state.locale = localeOverride || this.state.locale;\n        this.savePersisted(false);\n        this.render();\n        return this.state.session;\n      }\n\n      const url = new URL(`${apiBase}/api/embed/session`);\n      url.searchParams.set(\"key\", embedKey);\n      url.searchParams.set(\"host\", window.location.hostname);\n\n      const res = await fetch(url.toString(), { method: \"GET\" });\n      const data = (await res.json().catch(() => ({}))) as Partial<SessionPayload> & { error?: string };\n\n      if (!res.ok || !data.token) {\n        this.state.session = null;\n        this.renderError(data.error || \"Session error\");\n        return null;\n      }\n\n      const localeOverride = this.getLocaleOverride();\n      const locale = localeOverride || (isEs(data.locale || \"en\") ? \"es\" : \"en\");\n\n      this.state.session = {\n        token: data.token,\n        locale,\n        brand: (data.brand || \"\").trim(),\n        slug: (data.slug || \"\").trim(),\n        theme: (data.theme as Theme | null) || null,\n      };\n\n      this.cachedTheme = this.state.session.theme || null;\n      this.cachedBrand = this.state.session.brand || \"\";\n      this.state.locale = locale;\n      this.savePersisted(false);\n      this.render();\n      return this.state.session;\n    } catch {\n      this.renderError(\"Network error\");\n      return null;\n    }\n  }\n\n  private async tryRefreshSessionToken(): Promise<string | null> {\n    this.state.session = null;\n    const s = await this.ensureSession();\n    return s?.token ?? null;\n  }\n\n  private renderError(msg: string) {\n    this.ensureRoot();\n    this.root.innerHTML = `\n      <style>${this.css()}</style>\n      <div class=\"wrap inline\">\n        <div class=\"panel\">\n          <div class=\"header\">Aliigo</div>\n          <div class=\"body\"><div class=\"bubble bot\">${msg}</div></div>\n        </div>\n      </div>\n    `;\n  }\n\n  private css() {\n    return `\n      :host { all: initial; display: block; }\n      :host([floating-mode=\"absolute\"]) { position: relative; width: 100%; height: 100%; display: block; }\n\n      .wrap {\n        font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\";\n        box-sizing: border-box;\n        -webkit-font-smoothing: antialiased;\n      }\n      .wrap * { box-sizing: border-box; }\n\n      /* --- Positioning --- */\n      .floating.fixed {\n        position: fixed;\n        right: 20px;\n        bottom: 20px;\n        z-index: 99999;\n      }\n      .floating.absolute {\n        position: absolute;\n        inset: 0;\n        z-index: 99999;\n        display: flex;\n        justify-content: flex-end;\n        align-items: flex-end;\n        padding: 20px;\n      }\n      .floating.absolute .panel {\n        max-width: 100%;\n        max-height: 100%;\n      }\n      .inline { width: 100%; }\n      .hero { width: 100%; height: 100%; max-width: 100%; margin: 0 auto; }\n\n      /* --- Pill (Launcher) --- */\n      .pill {\n        border: 0; cursor: pointer; font-weight: 600;\n        border-radius: 99px; padding: 14px 24px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        transition: transform 0.2s ease, box-shadow 0.2s ease;\n        font-size: 15px;\n        display: flex; align-items: center; gap: 8px;\n      }\n      .pill:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.2); }\n      .pill:active { transform: translateY(0); }\n\n      /* --- Main Panel --- */\n      .panel {\n        width: 380px;\n        height: 600px;\n        max-height: 80vh;\n\n        background: var(--panel-bg, #ffffff); /* NEW */\n        border: 1px solid rgba(0,0,0,0.06);\n        border-radius: 16px;\n        overflow: hidden;\n        box-shadow: 0 8px 32px rgba(0,0,0,0.12);\n        display: flex;\n        flex-direction: column;\n      }\n\n      .panel.animate-in {\n      animation: panel-enter 0.3s cubic-bezier(0.16, 1, 0.3, 1);\n      }\n\n      .panel.inline { width: 100%; max-width: 100%; height: 500px; box-shadow: none; border: 1px solid #e5e7eb; }\n      .panel.hero { width: 100%; max-width: 100%; height: 100%; box-shadow: none; border: none; border-radius: 0; }\n\n      /* --- Header --- */\n      .header {\n        padding: 16px 20px;\n        display: flex; align-items: center; justify-content: space-between;\n        border-bottom: 1px solid rgba(0,0,0,0.05);\n        font-weight: 600;\n        font-size: 16px;\n        letter-spacing: -0.01em;\n      }\n      .close {\n        border: 0; background: transparent; cursor: pointer;\n        font-size: 24px; line-height: 1; opacity: 0.6;\n        padding: 4px; margin: -4px;\n        transition: opacity 0.2s;\n      }\n      .close:hover { opacity: 1; }\n\n      /* --- Body & Messages --- */\n      .body {\n        flex: 1;\n        min-height: 0;\n        position: relative;\n        background: transparent; /* NEW */\n      }\n      .messages {\n        height: 100%;\n        overflow-y: auto;\n        overflow-x: hidden;\n        padding: 20px;\n      }\n\n      .row {\n        margin-top: 12px;\n        display: flex;\n        width: 100%;\n      }\n      .row.user { justify-content: flex-end; }\n      .row.bot { justify-content: flex-start; }\n\n      /* --- Bubbles --- */\n      .bubble {\n        display: block;\n        position: relative;\n        max-width: 85%;\n        padding: 10px 16px;\n        border-radius: 18px;\n        font-size: 15px;\n        line-height: 1.5;\n        word-wrap: break-word;\n        white-space: normal;\n        box-shadow: 0 1px 2px rgba(0,0,0,0.04);\n        transform-origin: bottom center;\n      }\n\n      .bubble.anim {\n        animation: message-enter 0.3s cubic-bezier(0.25, 1, 0.5, 1) forwards;\n      }\n\n      .bubble.user {\n        border-bottom-right-radius: 4px;\n        margin-left: 40px;\n      }\n\n      .bubble.bot {\n        border-bottom-left-radius: 4px;\n        margin-right: 40px;\n        border: 1px solid rgba(0,0,0,0.04);\n      }\n\n      .bubble strong { font-weight: 600; }\n      .bubble .list { margin: 8px 0 0 0; padding-left: 18px; }\n      .bubble .list li { margin: 4px 0; }\n\n      /* --- Input Area --- */\n      .form {\n        flex: 0 0 auto;\n        display: flex;\n        gap: 10px;\n        padding: 16px;\n        border-top: 1px solid rgba(0,0,0,0.06);\n        background: rgba(255,255,255,0.06);\n        backdrop-filter: blur(6px);\n      }\n\n      /* --- Actions (buttons/links under assistant messages) --- */\n      .actions { margin-top: 8px; display:flex; flex-wrap:wrap; gap:8px; }\n      .action, .action-btn {\n        display:inline-flex; align-items:center; justify-content:center;\n        padding:10px 12px; border-radius:12px; font-weight:600; font-size:14px;\n        border:1px solid rgba(0,0,0,0.10); background:#fff; color:#111827;\n        text-decoration:none; cursor:pointer;\n      }\n      .action:hover, .action-btn:hover { border-color: rgba(0,0,0,0.18); }\n\n\n      .input {\n        flex: 1;\n        height: 44px;\n        border: 1px solid #e5e7eb;\n        background: #f9fafb;\n        border-radius: 22px;\n        padding: 0 16px;\n        font-size: 15px;\n        outline: none;\n        transition: all 0.2s ease;\n        color: #111827;\n      }\n      .input:focus {\n        background: #ffffff;\n        border-color: #d1d5db;\n        box-shadow: 0 0 0 3px rgba(0,0,0,0.05);\n      }\n      .input::placeholder { color: #9ca3af; }\n\n      .send {\n        height: 44px;\n        padding: 0 20px;\n        border: 0;\n        border-radius: 22px;\n        font-size: 15px;\n        font-weight: 600;\n        cursor: pointer;\n        flex-shrink: 0;\n        transition: transform 0.1s ease, opacity 0.2s;\n      }\n      .send:active { transform: scale(0.96); }\n      .send:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }\n\n      @keyframes message-enter {\n        0% { opacity: 0; transform: translateY(10px) scale(0.98); }\n        100% { opacity: 1; transform: translateY(0) scale(1); }\n      }\n      @keyframes panel-enter {\n        0% { opacity: 0; transform: translateY(20px) scale(0.96); }\n        100% { opacity: 1; transform: translateY(0) scale(1); }\n      }\n\n      @media (max-width: 480px) {\n      .floating.fixed { left: 0; right: 0; bottom: 0; }\n\n      /* Only go fullscreen if explicitly enabled */\n      :host([mobile-fullscreen=\"true\"]) .floating.fixed .panel {\n        width: 100%;\n        height: 100%;\n        max-height: 100%;\n        border-radius: 0;\n      }\n    }\n    `;\n  }\n\n  private render() {\n    this.ensureRoot();\n    const variant = this.getVariant();\n\n    \n\n\n    const needsRemoteTheme =\n      !!this.getEmbedKey() &&\n      !this.getThemeOverride() &&\n      !this.cachedTheme &&\n      !this.state.session?.theme;\n      if (needsRemoteTheme && !this.sessionHydrated) {\n        // prevent \u201Cstock \u2192 client\u201D flash on first paint\n        // keep space for inline/hero to avoid layout jump\n        const wrapperClass =\n          variant === \"floating\"\n            ? `wrap floating ${this.getFloatingMode()}`\n            : variant === \"hero\"\n              ? \"wrap hero\"\n              : \"wrap inline\";\n\n        const placeholderPanel =\n          variant === \"hero\" ? \"panel hero\" : variant === \"inline\" ? \"panel inline\" : \"panel\";\n\n        this.root.innerHTML = `\n          <style>${this.css()}</style>\n          <div class=\"${wrapperClass}\">\n            <div class=\"${placeholderPanel}\" style=\"visibility:hidden\"></div>\n          </div>\n        `;\n        return;\n      }\n\n\n    const session = this.state.session;\n    const locale = this.getLocaleOverride() || this.state.locale;\n    const t = UI[locale];\n\n\n    const theme = this.getThemeOverride() || session?.theme || this.cachedTheme || {};\n\n    const panelHex = (theme.panelBg || \"\").trim();\n    const panelOpacity =\n      typeof theme.panelOpacity === \"number\" ? clamp01(theme.panelOpacity) : 1;\n\n    const panelRgba = panelHex ? rgbaFromHex(panelHex, panelOpacity) : null;\n\n\n    const panelStyle = panelRgba ? `style=\"--panel-bg:${panelRgba};\"` : \"\";\n\n\n    const brand = (this.getBrandOverride() || session?.brand || this.cachedBrand || \"\").trim();\n\n    const header = splitPair(theme.headerBg, { bg: \"#111827\", text: \"#ffffff\" });\n    const user = splitPair(theme.bubbleUser, { bg: \"#2563eb\", text: \"#ffffff\" });\n    const bot = splitPair(theme.bubbleBot, { bg: \"#f3f4f6\", text: \"#111827\" });\n    const send = splitPair(theme.sendBg, { bg: \"#2563eb\", text: \"#ffffff\" });\n\n    const open = variant !== \"floating\" ? true : this.state.open;\n\n    const openNow = open;\n    const animateIn = openNow && !this.lastRenderOpen;\n    this.lastRenderOpen = openNow;\n\n    const floatingMode = this.getFloatingMode();\n    const wrapperClass =\n      variant === \"floating\"\n        ? `wrap floating ${floatingMode}`\n        : variant === \"hero\"\n          ? \"wrap hero\"\n          : \"wrap inline\";\n\n    const basePanelClass =\n      variant === \"hero\" ? \"panel hero\" : variant === \"inline\" ? \"panel inline\" : \"panel\";\n\n    const panelClass = animateIn ? `${basePanelClass} animate-in` : basePanelClass;\n\n\n    const msgs = this.state.msgs;\n    const messagesHtml =\n      msgs.length === 0\n        ? `<div class=\"row bot\" id=\"msg-0\">\n            <div class=\"bubble bot anim\" style=\"--bg:${bot.bg};--fg:${bot.text};background:var(--bg);color:var(--fg);\">\n              ${t.welcome}\n            </div>\n          </div>`\n        : msgs\n            .map((m, i) => {\n              const isUser = m.role === \"user\";\n              const isLast = i === msgs.length - 1;\n              const bubbleStyle = isUser\n                ? `--bg:${user.bg};--fg:${user.text};background:var(--bg);color:var(--fg);`\n                : `--bg:${bot.bg};--fg:${bot.text};background:var(--bg);color:var(--fg);`;\n\n              return `<div class=\"row ${isUser ? \"user\" : \"bot\"}\" id=\"msg-${i}\">\n                <div class=\"bubble ${isUser ? \"user\" : \"bot\"} ${isLast ? \"anim\" : \"\"}\" style=\"${bubbleStyle}\">\n                  ${formatMessageHtml(m.content)}\n                  ${\n                    !isUser && Array.isArray(m.actions) && m.actions.length\n                      ? `<div class=\"actions\">\n                          ${m.actions\n                            .map((a) => {\n                              if (a.type === \"link\") {\n                                return `<a class=\"action\" href=\"${escapeHtml(a.url)}\" target=\"_blank\" rel=\"noopener noreferrer\">${escapeHtml(a.label)}</a>`;\n                              }\n                              if (a.type === \"handoff\") {\n                                return `<button class=\"action-btn\" type=\"button\" data-action=\"handoff\" data-i=\"${i}\">${escapeHtml(a.label)}</button>`;\n                              }\n                              return \"\";\n                            })\n                            .join(\"\")}\n                        </div>`\n                      : \"\"\n                  }\n                </div>\n              </div>`;\n            })\n            .join(\"\");\n            \n\n    // floating closed => pill only\n    if (variant === \"floating\" && !open) {\n      this.lastRenderOpen = false;\n      const hasToken = !!session?.token || !!this.getSessionTokenOverride();\n      if (!hasToken) {\n        this.root.innerHTML = `<style>${this.css()}</style>`;\n        return;\n      }\n\n      this.root.innerHTML = `\n        <style>${this.css()}</style>\n        <div class=\"${wrapperClass}\">\n          <button class=\"pill\" style=\"background:${send.bg};color:${send.text};\">${t.pill(brand)}</button>\n        </div>\n      `;\n      this.root\n        .querySelectorAll(\".action-btn[data-action='handoff']\")\n        .forEach((btn) => {\n          btn.addEventListener(\"click\", () => {\n            // Temporary: send a message that triggers your server\u2019s lead-intent flow\n            void this.send(\"I\u2019d like a human follow-up.\");\n          });\n        });\n\n      const btn = this.root.querySelector(\".pill\") as HTMLButtonElement | null;\n      btn?.addEventListener(\"click\", () => {\n        this.state.open = true;\n        this.pendingFocus = true;\n        this.savePersisted(false);\n        this.pendingScroll = \"bottom\";\n        this.render();\n      });\n\n      return;\n    }\n\n    this.root.innerHTML = `\n      <style>${this.css()}</style>\n      <div class=\"${wrapperClass}\">\n      <div class=\"${panelClass}\" ${panelStyle}>\n          <div class=\"header\" style=\"background:${header.bg};color:${header.text};\">\n            <div>${t.title(brand)}</div>\n            ${variant === \"floating\" ? `<button class=\"close\" aria-label=\"Close\" style=\"color:${header.text};\">\u00D7</button>` : ``}\n          </div>\n\n          <div class=\"body\">\n            <div class=\"messages\">${messagesHtml}<div id=\"bottom\"></div></div>\n          </div>\n\n          <form class=\"form\">\n            <input class=\"input\" placeholder=\"${t.placeholder}\" />\n            <button class=\"send\" type=\"submit\" style=\"background:${send.bg};color:${send.text};\" ${this.state.busy || !session?.token ? \"disabled\" : \"\"}>${t.send}</button>\n          </form>\n        </div>\n      </div>\n    `;\n\n    const close = this.root.querySelector(\".close\") as HTMLButtonElement | null;\n    close?.addEventListener(\"click\", () => {\n      this.state.open = false;\n      this.savePersisted(false);\n      this.render();\n    });\n\n    const form = this.root.querySelector(\".form\") as HTMLFormElement | null;\n    const input = this.root.querySelector(\".input\") as HTMLInputElement | null;\n\n    form?.addEventListener(\"submit\", (e) => {\n      e.preventDefault();\n      const v = (input?.value || \"\").trim();\n      if (!v) return;\n      if (input) input.value = \"\";\n      this.pendingFocus = true;\n      void this.send(v);\n    });\n\n    this.applyPendingScroll();\n    this.applyPendingFocus();\n  }\n\n  private async send(content: string) {\n    const session = this.state.session;\n    if (!session?.token) return;\n\n    this.state.busy = true;\n    this.state.msgs = [...this.state.msgs, { role: \"user\", content }];\n    this.pendingFocus = true;\n    this.savePersisted(true);\n    this.pendingScroll = \"bottom\";\n    this.render();\n\n    try {\n      const apiBase = this.getApiBase();\n      const res = await fetch(`${apiBase}/api/conversation`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          token: session.token,\n          conversationId: this.state.conversationId,\n          externalRef: this.state.visitorSessionId,\n          message: content,\n          locale: this.state.locale,\n          channel: \"web\",\n        }),\n      });\n\n      const raw = (await res.json().catch(() => ({}))) as {\n        conversationId?: string;\n        reply?: string;\n        actions?: unknown;\n        error?: string;\n        locale?: string;\n      };\n\n      if (!res.ok) {\n        const errText = (raw.error || \"\").toLowerCase();\n\n        // Auto-recover from \"Session expired\" once (refresh token, retry)\n        if (res.status === 403 && errText.includes(\"session expired\")) {\n          const fresh = await this.tryRefreshSessionToken();\n\n          if (fresh) {\n            const retry = await fetch(`${apiBase}/api/conversation`, {\n              method: \"POST\",\n              headers: { \"Content-Type\": \"application/json\" },\n              body: JSON.stringify({\n                token: fresh,\n                conversationId: this.state.conversationId,\n                externalRef: this.state.visitorSessionId,\n                message: content,\n                locale: this.state.locale,\n                channel: \"web\",\n              }),\n            });\n\n            const raw2 = (await retry.json().catch(() => ({}))) as {\n              conversationId?: string;\n              reply?: string;\n              error?: string;\n              locale?: string;\n              actions?: unknown;\n            };\n\n            if (retry.ok) {\n              if (raw2.conversationId) this.state.conversationId = raw2.conversationId;\n              const nextActions2 = mapServerActionsToWidget(raw2.actions);\n\n              this.state.msgs = [\n                ...this.state.msgs,\n                { role: \"assistant\", content: raw2.reply || \"\", actions: nextActions2 },\n              ];\n              this.pendingFocus = true;\n              this.state.busy = false;\n              this.savePersisted(true);\n              this.pendingScroll = \"lastAssistantStart\";\n              this.render();\n              return;\n            }\n\n            // retry failed\n            this.state.msgs = [...this.state.msgs, { role: \"assistant\", content: raw2.error || \"Error\" }];\n            this.pendingFocus = true;\n            this.state.busy = false;\n            this.savePersisted(true);\n            this.pendingScroll = \"lastAssistantStart\";\n            this.render();\n            return;\n          }\n        }\n\n        // default error path\n        this.state.msgs = [...this.state.msgs, { role: \"assistant\", content: raw.error || \"Error\" }];\n        this.pendingFocus = true;\n        this.state.busy = false;\n        this.savePersisted(true);\n        this.pendingScroll = \"lastAssistantStart\";\n        this.render();\n        return;\n      }\n\n      if (raw.conversationId) this.state.conversationId = raw.conversationId;\n      const nextActions = mapServerActionsToWidget(raw.actions);\n      this.state.msgs = [\n        ...this.state.msgs,\n        { role: \"assistant\", content: raw.reply || \"\", actions: nextActions },\n      ];\n      this.pendingFocus = true;\n      this.state.busy = false;\n      this.savePersisted(true);\n      this.pendingScroll = \"lastAssistantStart\";\n      this.render();\n    } catch {\n      this.state.msgs = [...this.state.msgs, { role: \"assistant\", content: \"Network error\" }];\n      this.pendingFocus = true;\n      this.pendingScroll = \"lastAssistantStart\";\n      this.state.busy = false;\n      this.savePersisted(true);\n      this.render();\n    }\n  }\n}\n\nfunction escapeHtml(s: string) {\n  return (s || \"\")\n    .replaceAll(\"&\", \"&amp;\")\n    .replaceAll(\"<\", \"&lt;\")\n    .replaceAll(\">\", \"&gt;\")\n    .replaceAll('\"', \"&quot;\")\n    .replaceAll(\"'\", \"&#039;\");\n}\n\nfunction linkify(escaped: string) {\n  // escaped is already HTML-escaped, so safe to inject our own <a>\n  // Matches http(s) URLs\n  return escaped.replace(\n    /(https?:\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])/g,\n    `<a href=\"$1\" target=\"_blank\" rel=\"noopener noreferrer\">$1</a>`\n  );\n}\n\nfunction formatMessageHtml(raw: string) {\n  const escaped = escapeHtml(raw || \"\");\n  const escapedWithLinks = linkify(escaped);\n  const lines = escapedWithLinks.split(/\\r?\\n/);\n\n  const inline = (s: string) =>\n    s.replace(/\\*\\*(.+?)\\*\\*/g, \"<strong>$1</strong>\");\n\n  const joinLines = (arr: string[]) => inline(arr.join(\"<br/>\"));\n\n  // ---------- Numbered list ----------\n  const firstNumIdx = lines.findIndex((l) => /^\\s*\\d+\\.\\s+/.test(l));\n  if (firstNumIdx !== -1) {\n    const leadLines = lines.slice(0, firstNumIdx).filter((l) => l.trim() !== \"\");\n\n    const items: string[] = [];\n    const tailLines: string[] = [];\n\n    for (let i = firstNumIdx; i < lines.length; i++) {\n      const l = lines[i] ?? \"\";\n      if (/^\\s*\\d+\\.\\s+/.test(l)) {\n        items.push(l.replace(/^\\s*\\d+\\.\\s+/, \"\").trim());\n        continue;\n      }\n      if (l.trim() === \"\") continue;\n      tailLines.push(l);\n    }\n\n    if (items.length === 0) return joinLines(lines);\n\n    return `\n      ${leadLines.length ? `<div class=\"lead\">${joinLines(leadLines)}</div>` : \"\"}\n      <ol class=\"list\">\n        ${items.map((it) => `<li>${inline(it)}</li>`).join(\"\")}\n      </ol>\n      ${tailLines.length ? `<div class=\"tail\">${joinLines(tailLines)}</div>` : \"\"}\n    `;\n  }\n\n  // ---------- Bulleted list ----------\n  const firstBulIdx = lines.findIndex((l) => /^\\s*[-\u2022]\\s+/.test(l));\n  if (firstBulIdx !== -1) {\n    const leadLines = lines.slice(0, firstBulIdx).filter((l) => l.trim() !== \"\");\n\n    const items: string[] = [];\n    const tailLines: string[] = [];\n\n    for (let i = firstBulIdx; i < lines.length; i++) {\n      const l = lines[i] ?? \"\";\n      if (/^\\s*[-\u2022]\\s+/.test(l)) {\n        items.push(l.replace(/^\\s*[-\u2022]\\s+/, \"\").trim());\n        continue;\n      }\n      if (l.trim() === \"\") continue;\n      tailLines.push(l);\n    }\n\n    if (items.length === 0) return joinLines(lines);\n\n    return `\n      ${leadLines.length ? `<div class=\"lead\">${joinLines(leadLines)}</div>` : \"\"}\n      <ul class=\"list\">\n        ${items.map((it) => `<li>${inline(it)}</li>`).join(\"\")}\n      </ul>\n      ${tailLines.length ? `<div class=\"tail\">${joinLines(tailLines)}</div>` : \"\"}\n    `;\n  }\n\n  // ---------- Fallback ----------\n  return joinLines(lines);\n}\n\nif (!customElements.get(\"aliigo-widget\")) {\n  customElements.define(\"aliigo-widget\", AliigoWidget);\n}\n"],
  "mappings": "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",
  "names": ["mapServerActionsToWidget", "actions", "out", "a", "obj", "t", "label", "url", "UI", "brand", "isEs", "locale", "splitPair", "v", "defaults", "m", "bg", "text", "clamp01", "n", "hexToRgb", "hex", "h", "r", "g", "b", "rgbaFromHex", "rgb", "AliigoWidget", "host", "name", "oldValue", "newValue", "msLeft", "messages", "mode", "_a", "max", "i", "el", "desired", "input", "k", "existing", "rnd", "id", "embedKey", "overrideToken", "key", "raw", "parsed", "lastActive", "touch", "now", "savedAt", "prevLastActiveAt", "prevRaw", "prev", "nextLastActiveAt", "payload", "o", "apiBase", "localeOverride", "themeOverride", "brandOverride", "res", "data", "s", "msg", "variant", "wrapperClass", "placeholderPanel", "session", "theme", "panelHex", "panelOpacity", "panelRgba", "panelStyle", "header", "user", "bot", "send", "open", "openNow", "animateIn", "floatingMode", "basePanelClass", "panelClass", "msgs", "messagesHtml", "isUser", "isLast", "bubbleStyle", "formatMessageHtml", "escapeHtml", "btn", "close", "form", "e", "content", "errText", "fresh", "retry", "raw2", "nextActions2", "nextActions", "linkify", "escaped", "_b", "lines", "inline", "joinLines", "arr", "firstNumIdx", "leadLines", "l", "items", "tailLines", "it", "firstBulIdx"]
}
